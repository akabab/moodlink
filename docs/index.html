<html>
<body>
  <h2>MoodLink</h2>
  <input type='file' id='file' multiple>
  <button onclick='sendImages()'>Send</button>
  <button onclick='getCSV()'>Get CSV</button>

  <script type='text/javascript'>
    const apiKey = 'fbaebc54c4784496b7f6f2ca426f82c8'
    const apiUrl = 'https://westus.api.cognitive.microsoft.com/emotion/v1.0/recognize'

    const headers = {
      'Ocp-Apim-Subscription-Key': apiKey,
      'Content-Type': 'application/octet-stream',
    }

    let csv = 'anger,contempt,disgust,fear,happiness,neutral,sadness,surprise'

    function sendImages() {
      const files = document.getElementById('file').files

      Array.from(files).forEach(sendImage)
    }

    function sendImage(image) {
      const options = {
        method: 'POST',
        headers,
        processData: false,
        body: image
      }

      fetch(apiUrl, options)
      .then(res => res.json())
      .then(data => {
        console.log('data', data)
        const scores = data[0].scores

        const s = Object.values(scores).join(',')

        csv = [csv, s].join('\n')
      })
    }

    function getCSV() {
      const e = document.createElement('a');

      e.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv)
      e.target = '_blank'
      e.download = 'moods.csv'
      e.click()
    }
  </script>
</body>
</html>